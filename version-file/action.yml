name: Version File
description: Set version in file
inputs:
  version:
    description: 'The version to set'
    required: true
  version_file:
    description: 'Set version in VERSION file'
    required: false
    default: "false"
  version_makefile:
    description: 'Set version in Makefile'
    required: false
    default: "false"
  version_package:
    description: 'Set version in package.json'
    required: false
    default: "false"
  version_chart:
    description: 'Set version in chart dir'
    required: false
    default: "false"
  repo_name:
    description: 'The name of the repository'
    required: false
    default: ""
runs:
  using: "composite"
  steps:
    - name: set version in file
      shell: bash
      run: |
        if [ "${{ inputs.version_file }}" == "true" ]; then
          echo "Set version in VERSION file to: ${{ inputs.version }}"
          echo '${{ inputs.version }}' > VERSION
        fi
        if [ "${{ inputs.version_makefile }}" == "true" ]; then
          echo "Set version in Makefile to: ${{ inputs.version }}"
          sed -i "s@^VERSION .*@VERSION ?= ${{ inputs.version }}@" Makefile
        fi
        if [ "${{ inputs.version_package }}" == "true" ]; then
          echo "Set version in package.json to: ${{ inputs.version }}"
          sed -i "s@\"version\":.*@\"version\": \"${{ inputs.version }}\",@" package.json
        fi
        if [ "${{ inputs.version_chart }}" == "true" ] && [ -n "${{ inputs.repo_name }}" ]; then
          echo "Set version in chart dir to: ${{ inputs.version }}"
          sed -i "s/^version:.*/version: ${{ inputs.version }}/" charts/${{ inputs.repo_name }}/Chart.yaml
          sed -i "s/tag:.*/tag: ${{ inputs.version }}/" charts/${{ inputs.repo_name }}/values.yaml
        fi
